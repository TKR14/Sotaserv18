<?xml version="1.0"?>
<odoo>

        <record id="building_attachment_form" model="ir.ui.view">
            <field name="name">building.attachment.form</field>
            <field name="model">building.attachment</field>
            <field name="arch" type="xml">
                <form string="Attachement Client" duplicate="false">
                	<header>
                        <button name="open_back_to_draft_reason_wizard" string="Remettre" class="oe_highlight" type="object" groups="account.group_account_invoice,building_plus.sotaserv_directeur_zone" invisible="open_attachment_state != 'internal_validated' or not_open_attachment_state != 'internal_validated'" context="{'method': 'action_draft_attachment'}" />
                        <button name="action_internal_validated" string="Valider" class="oe_highlight" type="object" groups="building_plus.sotaserv_chef_projet,building_plus.sotaserv_conduct_trv" invisible="open_attachment_state != 'draft' or not_open_attachment_state != 'draft'"/>
                        <button name="action_validation_accounting" string="Valider" class="oe_highlight" type="object" groups="account.group_account_invoice" invisible="open_attachment_state != 'internal_validated' or not opening_attachment"/>
                        <button name="action_count_established" string="Établir" class="oe_highlight" type="object" groups="building_plus.sotaserv_directeur_zone" invisible="not_open_attachment_state != 'internal_validated' or opening_attachment"/>
                        <button name="open_back_to_draft_reason_wizard" string="Remettre" class="oe_highlight" type="object" groups="account.group_account_invoice" invisible="open_attachment_state != 'validated_accounting' or is_open_back_cp_ct_visible" context="{'method': 'opning_action_back_cp_ct'}" />
                        <button name="print_attachment_client" string="Imprimer Attachement" class="oe_highlight" type="object" groups=""/>
                        <!-- <button name="action_draft" string="Remettre" class="oe_highlight" type="object" groups="" attrs="{'invisible': ['|', ('state', 'in', ('draft', 'internal_validated', 'count_established')), ('is_inv_posted', '=', True)]}"/> -->
						<field name="open_attachment_state" invisible="not opening_attachment" widget="statusbar" statusbar_visible="draft,internal_validated,validated_accounting" statusbar_colors='{"draft":"blue","done":"blue"}'/>
						<field name="not_open_attachment_state" invisible="opening_attachment" widget="statusbar" statusbar_visible="draft,internal_validated,count_established" statusbar_colors='{"draft":"blue","done":"blue"}'/>
                        <field name="is_open_back_cp_ct_visible" invisible="1"/>
					</header>
                    <sheet>
	                    <group class="attachmnet_group">
                            <group col="2" width="900px !important;">
                                <separator string="Informations générales" colspan="2"/>
                                <field name="customer_id" readonly="1" options="{'no_open': True}"/>
                                <field name="site_id" readonly="1" options="{'no_open': True}"/>
                                <field name="type_marche" readonly="1"/>
                            </group>
                            <group col="2">
                                <separator string="Période de l'attachement" colspan="2"/>
                                <field name="number" readonly="1"/>
                                <field name="start_date" readonly="not_open_attachment_state != 'draft' or opening_attachment"/>
                                <field name="end_date" readonly="not_open_attachment_state != 'draft' or opening_attachment"/>
                                <field name="definitive_ok" widget="boolean_toggle" force_save="1" readonly="not_open_attachment_state != 'draft' or is_readonly_last_attachment" invisible="opening_attachment"/>
                                <field name="opening_attachment" invisible="1"/>
                                <field name="is_readonly_last_attachment" invisible="1"/>
                            </group>
                        </group>
	                    <notebook>
                            <page string="Détails de l'attachement">
	                            <field name="line_ids" nolabel="1" options="{'no_open': True}" widget="section_and_note_one2many">
                                    <list string="Détails de l'Attachement" editable="bottom" delete="0" create="0" class="disable_sort" default_order='sequence,id'>
                                        <field name="id" invisible="1"/>
                                        <field name="sequence" invisible="1"/>
                                        <field name="display_type" readonly="1" invisible="1"/>
                                        <field name="name" readonly="1" string="Produit" widget="section_and_note_text" force_save="True"/>
			             				<field name="product_uom_id" readonly="1" options="{'no_open': True}"/>
                                        <field name="price_quantity" readonly="1"/>
                                        <field name="previous_quantity" readonly="1" force_save="1"/>
                                        <field name="cumulative_quantity" readonly="parent.open_attachment_state != 'draft' or parent.not_open_attachment_state != 'draft'"/>
                                        <field name="percentage_completion" readonly="1"/>
									</list>
	                            </field>
	                        </page>
                            <page string="Autres Informations" name="other_info" invisible="1">
                                <group>
                                    <field name="is_inv_posted" readonly="1" force_save="1"/>
                                </group>
                            </page>
		                </notebook>
                        <group class="oe_subtotal_footer oe_right" invisible="not opening_attachment">
                            <field name="cumulative_amount_untaxed" />
                            <field name="cumulative_amount_tax" />
                            <field name="cumulative_amount" />
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" />
                        <field name="activity_ids" />
                        <field name="message_ids" />
                    </div>
                </form>
            </field>
        </record>
        
     	<record id="building_attachment_tree" model="ir.ui.view">
            <field name="name">building.attachment.tree</field>
            <field name="model">building.attachment</field>
            <field name="arch" type="xml">
                    <list string="Bon d'Attachement Client" create="0" duplicate="false">
                    <field name="number"/>
                  	<field name="order_id" string="BP"/>
                    <field name="site_id"/>
                    <field name="partner_id" invisible="1"/>
                    <field name="customer_id"/>
                    <field name="start_date" widget="badge" decoration-success="start_date != False"/>
                    <field name="end_date" widget="badge" decoration-danger="end_date != False"/>
                    <field name="final_state" widget="badge" decoration-info="final_state == 'draft'" decoration-warning="final_state == 'internal_validated'" decoration-success="final_state in ['validated_accounting', 'count_established']"/>
                </list>
            </field>
        </record>

        <!-- <record id="building_attachment_act" model="ir.actions.act_window">
            <field name="res_model">building.attachment</field>
            <field name="name">Attachements Client</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_type_attachment':'sale'}</field>
            <field name="domain">[('type_attachment','=','sale')]</field>
            <field name="view_id" ref="building_attachment_tree"/>
        </record> -->

        <record id="building_attachment_act_server" model="ir.actions.server">
            <field name="name">Attachements Client</field>
            <field name="model_id" ref="building.model_building_attachment"/>
            <field name="state">code</field>
            <field name="code">action = model.action_get_user_attachments_clinet()</field>
        </record>
        
        <!-- <menuitem
            id="building_achat_attchement_menu_group_achat"
            name="Attachements"
            groups="account.group_account_invoice"
            parent="building_plus.menu_acount_move_group_invoice_sites_root"
            sequence="30"
        />

        <menuitem
            id="building_achat_attchement_menu_group_achat_1"
            name="Attachements Client"
            parent="building_achat_attchement_menu_group_achat"
            action="building_attachment_act_server"
            sequence="10"
        />  a deplacer dans module building_plus-->

        <record id="building_supplier_attachment_form" model="ir.ui.view">
            <field name="name">building.supplier.attachment.form</field>
            <field name="model">building.attachment</field>
            <field name="arch" type="xml">
                <form string="Bon d'Attachement Fournisseur">
                	<header>
						<button name="action_customer_validated" string="Valider par le sous-traitant" class="oe_highlight" type="object" invisible="state in ('supplier_validated', 'internal_validated', 'done')"/>
                        <button name="action_internal_validated" string="Valider en interne" class="oe_highlight" type="object" invisible="state in ('draft', 'internal_validated', 'done')"/>
                        <button name="action_done" string="Facturer" class="oe_highlight" type="object" invisible="state in ('draft', 'supplier_validated', 'done')"/>
						<field name="state" widget="statusbar" statusbar_visible="draft,supplier_validated,internal_validated,done" statusbar_colors='{"draft":"blue","done":"blue"}'/>
					</header>
	                    <group>
                            <group col="2">
                                <separator string="Informations générales" colspan="2"/>
                                <field name="name"/>
	                    	    <field name="number"/>
                                <field name="site_id"/>
                                <field name="partner_id" invisible="1"/>
	                            <field name="supplier_id"/>
                                <field name="type_marche" invisible="1"/>
                            </group>
                            <group col="2">
                                 <separator string="Période de l'attachement" colspan="2"/>
                                  <field name="date"/>
                                  <field name="start_date"/>
                                  <field name="end_date"/>
                                  <field name="delay_attachment"/>
                                  <field name="definitive_ok"/>
                            </group>
	                    </group>
	                    <notebook>
	                        <page string="Détails de l'attachement">
	                            <field name="line_ids" nolabel="1">
	                            	<list string="Détails de l'Attachement" editable="bottom">
			              				<field name="product_id" invisible="1"/>
                                        <field name="name" string="Produit"/>
			             				<field name="product_uom_id"/>
                                        <field name="tax_id" invisible="1"/>
                                        <field name="cumulative_quantity" readonly="0"/>
                                        <field name="previous_quantity" readonly="1" />
			             				<field name="current_quantity" readonly="1"/>
									</list>
	                            </field>
	                        </page>
		                </notebook>
                </form>
            </field>
        </record>

     	<record id="building_supplier_attachment_tree" model="ir.ui.view">
            <field name="name">building.supplier.attachment.tree</field>
            <field name="model">building.attachment</field>
            <field name="arch" type="xml">
                <list string="Bon d'Attachement Fournisseur" create="0">
                    <field name="name"/>
                  	<field name="subcontracting_id"/>
                    <field name="site_id"/>
                    <field name="supplier_id"/>
                    <field name="start_date"/>
                    <field name="end_date"/>
                    <field name="state"/>
                </list>
            </field>
        </record>

        <record id="building_supplier_attachment_act" model="ir.actions.act_window">
            <field name="res_model">building.attachment</field>
            <field name="name">Attachements Fournisseur</field>
            <field name="view_mode">list,form</field>
            <field name="context">{'default_type_attachment':'purchase'}</field>
            <field name="domain">[('type_attachment', '=', 'purchase')]</field>
        </record>

        <record model="ir.actions.act_window.view" id="building_supplier_attachment_tree_act">
            <field name="sequence" eval="1"/>
            <field name="view_mode">list</field>
            <field name="view_id" ref="building_supplier_attachment_tree"/>
            <field name="act_window_id" ref="building_supplier_attachment_act"/>
        </record>

        <record model="ir.actions.act_window.view" id="building_supplier_attachment_form_tree_act">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="building_supplier_attachment_form"/>
            <field name="act_window_id" ref="building_supplier_attachment_act"/>
        </record>

        <record id="building_attachment_inv_form" model="ir.ui.view">
            <field name="name">building.attachment.inv.form</field>
            <field name="model">building.attachment</field>
            <field name="arch" type="xml">
                <form string="Décompte Client" create="false" delete="false" duplicate="false">
                    <header>
                        <button name="open_back_to_draft_reason_wizard" string="Remettre" class="oe_highlight" type="object" groups="building_plus.sotaserv_directeur_zone" invisible="state != 'draft'" context="{'method': 'action_back_to_attachment_draft'}"/>
                        <button name="action_dz_validated" string="Valider" class="oe_highlight" type="object" groups="building_plus.sotaserv_directeur_zone" invisible="state != 'draft'"/>
                        <button name="open_back_to_draft_reason_wizard" string="Remettre" class="oe_highlight" type="object" groups="" invisible="state != 'dz_validated'" context="{'method': 'back_to_draft_decompte'}"/>
                        <button name="action_customer_validated" string="Valider" class="oe_highlight" type="object" groups="account.group_account_invoice" invisible="state != 'dz_validated'"/>
                        <button name="open_back_to_draft_reason_wizard" string="Remettre" class="oe_highlight" type="object" groups="account.group_account_invoice" invisible="state != 'customer_validated'" context="{'method': 'back_to_dz_validated'}"/>
                        <button name="action_validation_accounting_decompte" string="Valider" class="oe_highlight" type="object" groups="account.group_account_invoice" invisible="state != 'customer_validated'"/>
                        <button name="open_back_to_draft_reason_wizard" string="Remettre" class="oe_highlight" type="object" groups="account.group_account_invoice" invisible="state != 'validated_accounting'" context="{'method': 'back_to_customer_validated_decompte'}"/>
                        <button name="action_done" string="Facturer" class="oe_highlight" type="object" groups="account.group_account_invoice" confirm="Voulez-vous vraiment créer la facture de décompte ?" invisible="state != 'validated_accounting'"/>
                        <button name="open_back_to_draft_reason_wizard" string="Remettre" class="oe_highlight" type="object" groups="account.group_account_invoice" invisible="state != 'done' or is_inv_posted" context="{'method': 'action_draft'}"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,dz_validated,customer_validated,validated_accounting,done" statusbar_colors='{"draft":"blue","done":"blue"}'/>
                    </header>
                        <!-- <group>
                            <group col="2">
                                <separator string="Informations BP" colspan="2"/>
                                <field name="name" attrs="{'readonly': [('state', 'in', ('customer_validated', 'done'))]}" string="Nom" readonly="1" force_save="1"/>
                                <field name="number" attrs="{'readonly': [('state', 'in', ('customer_validated', 'done'))]}" string="Numéro" readonly="1" force_save="1"/>
                                <field name="ref_inv_count" attrs="{'readonly': [('state', 'in', ('customer_validated', 'done'))], 'invisible': [('state', 'in', ('draft'))]}"/>
                                <field name="site_id" attrs="{'readonly': [('state', 'in',('customer_validated', 'done'))]}" readonly="1" force_save="1"/>
                                <field name="partner_id" invisible="1"/>
                                <field name="customer_id" readonly="state in ('customer_validated', 'done')" readonly="1" force_save="1"/>
                                <field name="type_marche" invisible="0" readonly="state in ('customer_validated', 'done')"/>
                            </group>
                            <group col="2">
                                <separator string="Période" colspan="2"/>
                                <field name="start_date" readonly="state in ('customer_validated', 'done')"/>
                                <field name="end_date" readonly="state in ('customer_validated', 'done')"/>
                                <field name="date" readonly="state in ('customer_validated', 'done')"/>
                                <field name="delay_attachment" readonly="state in ('customer_validated', 'done')" string="Durée"/>
                                <field name="definitive_ok" readonly="state in ('customer_validated', 'done')" readonly="1" force_save="1"/>
                            </group>
                        </group> -->
                    <sheet>
                        <group colspan="4" class="container">
                            <group string="Informations BDP" colspan="1">
                                <field name="customer_id" id="supplier_id" readonly="1" options="{'no_open': True}"/>
                                <field name="site_id" id="site_id" readonly="1" options="{'no_open': True}"/>
                                <field name="order_id" id="purchase_id" invisible="1" readonly="1" options="{'no_open': True}"/>
                                <field name="currency_id" widget="many2one" readonly="1" options="{'no_open': True}"/>
                                <field name="amount_order" readonly="1"/>
                                <field name="represent" required="1"/>
                                <field name="number" readonly="1" string="N° de décompte" options="{'no_open': True}"/>
                                <field name="start_date" id="start_date" readonly="1"/>
                                <field name="end_date" id="end_date" readonly="1"/>
                                <field name="prc_advance_deduction" invisible="1" readonly="1"/>
                                <field name="definitive_ok" widget="boolean_toggle" readonly="state != 'draft' or is_readonly_last_attachment" string="Décompte final" force_save="1"/>
                                <field name="is_readonly_last_attachment" invisible="1"/>
                                <field name="type_marche" invisible="1"/>
                            </group>
                            <group colspan="1" string="Situation Globale" class="oe_group2">
                                <field name="accumulations_work" style="width: 150px !important;"/>
                                <field name="accumulation_previous_amounts" style="width: 150px !important;"/>
                                <field name="amount_invoiced" style="width: 150px !important;"/>
                                <field name="deduction_all_risk_insurance_ttc" style="width: 150px !important;"/>
                                <field name="deduction_malus_retention_ht" style="width: 150px !important;"/>
                                <field name="gross_amount_ht" style="width: 150px !important;"/>
                                <field name="amount_invoiced_ttc" style="width: 150px !important;"/>
                                <field name="deduction_advance_ttc" style="width: 150px !important;"/>
                                <field name="deduction_rg_ttc" style="width: 150px !important;"/>
                                <field name="deduction_ten_year_ttc" style="width: 150px !important;"/>
                                <field name="net_amount_to_be_invoiced" style="width: 150px !important;"/>
                                <field name="executed" class="rg" style="width: 150px !important;"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Détails BDP">
                                <field name="line_ids" nolabel="1" options="{'no_open': True}" readonly="state in ('customer_validated', 'done')" delete="False" widget="section_and_note_one2many">
                                    <list string="Détails de l'Attachement" editable="bottom" create="0" delete="0">
                                        <field name="sequence" invisible="1" widget="handle"/>
                                        <field name="display_type" invisible="1"/>
                                        <field name="name" readonly="1" string="Produit" widget="section_and_note_text"/>
                                        <field name="chapter" invisible="1"/>
                                        <field name="product_id" invisible="1"/>
                                        <field name="price_quantity" readonly="1" column_invisible="parent.type_marche == 'metre'"/>
                                        <field name="price_unit" readonly="1"/>
                                        <field name="cumulative_quantity" readonly="1"/>
                                        <field name="product_uom_id" readonly="1" options="{'no_open': True}"/>
                                        <field name="tax_id" readonly="1" invisible="1" widget="many2many_tags"/>
                                        <field name="cumulative_price_subtotal" readonly="1"/>
                                        <field name="percentage_completion" readonly="1" column_invisible="parent.type_marche == 'metre'"/>
                                    </list>
                                </field>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="cumulative_amount_untaxed" />
                                    <field name="cumulative_amount_tax" />
                                    <field name="cumulative_amount" />
                                </group>
                            </page>
                            <page string="Autres Informations" name="other_info" invisible="1">
                                <group>
                                    <field name="is_inv_posted" readonly="1" force_save="1"/>
                                </group>
                            </page>
                            <page string="Déductions">
                                <group>
                                    <group string="Déductions">
                                        <label for="deduction_advance" style="white-space: nowrap;" string="Avance (TTC)"/>
                                        <field name="deduction_advance" readonly="state != 'draft' or amount_advance_ttc == 0" nolabel="1" class="oe_right"/>
                                        <label for="deduction_prc_gr" style="white-space: nowrap;" string="RG (TTC)"/>
                                        <field name="deduction_prc_gr" nolabel="1" class="oe_right"/>
                                        <label for="deduction_ten_year" style="white-space: nowrap;" string="Assurance Décennale (TTC)"/>
                                        <field name="deduction_ten_year" readonly="state != 'draft' or amount_ten_year_ttc == 0" nolabel="1" class="oe_right"/>
                                       <label for="deduction_all_risk_insurance" style="white-space: nowrap;" string="Assurance TRC (HT)"/>
                                        <field name="deduction_all_risk_insurance" readonly="state != 'draft' or amount_all_risk_insurance_ttc == 0" nolabel="1" class="oe_right"/>
                                        <label for="deduction_malus_retention" style="white-space: nowrap;" string="Retenue de malfaçons (HT)"/>
                                        <field name="deduction_malus_retention" readonly="state != 'draft'" nolabel="1" class="oe_right"/>
                                    </group>
                                    <group string="Cumul déductions">
                                        <label for="cumulative_advance_ttc" style="white-space: nowrap;" string="Avance (TTC)"/>
                                        <field name="cumulative_advance_ttc" nolabel="1" class="oe_right"/>
                                        <label for="cumulative_rg_ttc" style="white-space: nowrap;" string="RG (TTC)"/>
                                        <field name="cumulative_rg_ttc" nolabel="1" class="oe_right"/>
                                        <label for="cumulative_ten_year_ttc" style="white-space: nowrap;" string="Assurance Décennale (TTC)"/>
                                        <field name="cumulative_ten_year_ttc" nolabel="1" class="oe_right"/>
                                        <label for="cumulative_all_risk_insurance_ttc" style="white-space: nowrap;" string="Assurance TRC (HT)"/>
                                        <field name="cumulative_all_risk_insurance_ttc" nolabel="1" class="oe_right"/>
                                        <label for="cumulative_malus_retention_ht" style="white-space: nowrap;" string="Retenue de malfaçons (HT)"/>
                                        <field name="cumulative_malus_retention_ht" nolabel="1" class="oe_right"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Inf.Affaire">
                                <group>
                                    <group>
                                        <label for="amount_advance_ttc" style="white-space: nowrap;" string="Montant d'avance (TTC)"/>
                                        <field name="amount_advance_ttc" nolabel="1" class="oe_right"/>
                                        <label for="prc_rg" style="white-space: nowrap;" string="RG (%)"/>
                                        <field name="prc_rg" nolabel="1" class="oe_right"/>
                                    </group>
                                    <group>
                                        <label for="amount_all_risk_insurance_ttc" style="white-space: nowrap;" string="Montant Assurance TRC (TTC)"/>
                                        <field name="amount_all_risk_insurance_ttc" nolabel="1" class="oe_right"/>
                                        <label for="amount_ten_year_ttc" style="white-space: nowrap;" string="Montant Assurance Décennale (TTC)"/>
                                        <field name="amount_ten_year_ttc" nolabel="1" class="oe_right"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter" modifiers="{}">
                        <field name="message_follower_ids" modifiers="{'readonly':[['state','!=','draft']]}" id="message_follower_ids"/>
                        <field name="activity_ids" modifiers="{'readonly':[['state','!=','draft']]}" id="activity_ids"/>
                        <field name="message_ids" modifiers="{'readonly':[['state','!=','draft']]}" id="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        
        <record id="building_attachment_inv_tree" model="ir.ui.view">
            <field name="name">building.attachment.tree</field>
            <field name="model">building.attachment</field>
            <field name="arch" type="xml">
                <list string="Décompte Client" create="0">
                    <field name="number"/>
                    <field name="order_id" string="BP"/>
                    <field name="site_id"/>
                    <field name="partner_id" invisible="1"/>
                    <field name="customer_id"/>
                    <field name="start_date" widget="badge"  decoration-success="start_date != False"/>
                    <field name="end_date" widget="badge"  decoration-danger="end_date != False"/>
                    <field
                        name="state" 
                        widget="badge" 
                        decoration-info="state == 'draft'"
                        decoration-warning="state in ['internal_validated', 'count_established', 'customer_validated', 'supplier_validated']" 
                        decoration-success="state == 'done'" />
            </list>
            </field>
        </record>

        <record id="building_attachment_inv_act" model="ir.actions.act_window">
            <field name="res_model">building.attachment</field>
            <field name="name">Décompte Clients</field>
            <field name="view_mode">list,form</field>
            <field name="context">{'default_type_attachment':'sale', 'group_by': 'site_id',}</field>
            <field name="domain">[('opening_attachment', '=', False), ('type_attachment', '=', 'sale'), ('not_open_attachment_state', '=', 'count_established')]</field>
            <field name="view_id" ref="building_attachment_inv_tree"/>
        </record>

        <record id="building_decompte_dz_act_server" model="ir.actions.server">
            <field name="name">Décompte Client</field>
            <field name="model_id" ref="building.model_building_attachment"/>
            <field name="state">code</field>
            <field name="code">action = model.action_get_dz_users_client()</field>
        </record>

        <record model="ir.actions.act_window.view" id="building_attachment_inv_tree_act">
            <field name="sequence" eval="1"/>
            <field name="view_mode">list</field>
            <field name="view_id" ref="building_attachment_inv_tree"/>
            <field name="act_window_id" ref="building_attachment_inv_act"/>
        </record>

        <record model="ir.actions.act_window.view" id="building_attachment_inv_form_act">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="building_attachment_inv_form"/>
            <field name="act_window_id" ref="building_attachment_inv_act"/>
        </record>

        <record id="building_attachment_inv_situation_form" model="ir.ui.view">
            <field name="name">building.attachment.inv.form</field>
            <field name="model">building.attachment</field>
            <field name="arch" type="xml">
                <form string="Décompte Client" create="false" delete="false" duplicate="false" edite="false">
                    <header>
                        <button name="print_decompte_provisional_report" string="Imprimer Décompte" invisible="state != 'done'" class="btn-primary" type="object"/>
                        <button name="print_decompte" string="Imprimer Décompte" invisible="state not in ('customer_validated', 'validated_accounting', 'supplier_validated')" class="btn-primary" type="object"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,customer_validated,validated_accounting,done" statusbar_colors='{"draft":"blue","done":"blue"}'/>
                    </header>
                    <sheet>
                        <group colspan="4" class="container">
                            <group string="Informations BDP" colspan="1">
                                <field name="customer_id" id="supplier_id" readonly="1" options="{'no_open': True}"/>
                                <field name="site_id" id="site_id" readonly="1" options="{'no_open': True}"/>
                                <field name="order_id" id="purchase_id" invisible="1" readonly="1" options="{'no_open': True}"/>
                                <field name="currency_id" widget="many2one" readonly="1" options="{'no_open': True}"/>
                                <field name="amount_order" readonly="1"/>
                                <field name="represent" required="1"/>
                                <field name="number" readonly="1" string="N° de décompte" options="{'no_open': True}"/>
                                <field name="start_date" id="start_date" readonly="1"/>
                                <field name="end_date" id="end_date" readonly="1"/>
                                <field name="prc_advance_deduction" invisible="1" readonly="1"/>
                                <field name="definitive_ok" widget="boolean_toggle" readonly="1" string="Décompte final" force_save="1"/>
                                <field name="is_readonly_last_attachment" invisible="1"/>
                                <field name="type_marche" invisible="1"/>
                            </group>
                            <group colspan="1" string="Situation Globale" class="oe_group2">
                                <field name="accumulations_work" style="width: 150px !important;"/>
                                <field name="accumulation_previous_amounts" style="width: 150px !important;"/>
                                <field name="amount_invoiced" style="width: 150px !important;"/>
                                <field name="deduction_all_risk_insurance_ttc" style="width: 150px !important;"/>
                                <field name="deduction_malus_retention_ht" style="width: 150px !important;"/>
                                <field name="gross_amount_ht" style="width: 150px !important;"/>
                                <field name="amount_invoiced_ttc" style="width: 150px !important;"/>
                                <field name="deduction_advance_ttc" style="width: 150px !important;"/>
                                <field name="deduction_rg_ttc" style="width: 150px !important;"/>
                                <field name="deduction_ten_year_ttc" style="width: 150px !important;"/>
                                <field name="net_amount_to_be_invoiced" style="width: 150px !important;"/>
                                <field name="executed" class="rg" style="width: 150px !important;"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Détails BDP">
                                <field name="line_ids" nolabel="1" options="{'no_open': True}" readonly="state in ('customer_validated', 'done')" delete="False" widget="section_and_note_one2many">
                                    <list string="Détails de l'Attachement" editable="bottom" create="0" delete="0" class="disable_sort" default_order='sequence,id'>
                                        <field name="id" invisible="1"/>
                                        <field name="sequence" invisible="1" widget="handle"/>
                                        <field name="display_type" invisible="1"/>
                                        <field name="name" readonly="1" string="Produit" widget="section_and_note_text"/>
                                        <field name="chapter" invisible="1"/>
                                        <field name="product_id" invisible="1"/>
                                        <field name="price_quantity" readonly="1" column_invisible="parent.type_marche == 'metre'"/>
                                        <field name="price_unit" readonly="1"/>
                                        <field name="cumulative_quantity" readonly="1"/>
                                        <field name="product_uom_id" readonly="1" options="{'no_open': True}"/>
                                        <field name="tax_id" readonly="1" invisible="1" widget="many2many_tags"/>
                                        <field name="cumulative_price_subtotal" readonly="1"/>
                                        <field name="percentage_completion" readonly="1" column_invisible="parent.type_marche == 'metre'"/>
                                    </list>
                                </field>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="cumulative_amount_untaxed" />
                                    <field name="cumulative_amount_tax" />
                                    <field name="cumulative_amount" />
                                </group>
                            </page>
                            <page string="Autres Informations" name="other_info" invisible="1">
                                <group>
                                    <field name="is_inv_posted" readonly="1" force_save="1"/>
                                </group>
                            </page>
                            <page string="Déductions">
                                <group>
                                    <group string="Déductions">
                                        <label for="deduction_advance" style="white-space: nowrap;" string="Avance (TTC)"/>
                                        <field name="deduction_advance" readonly="1" nolabel="1" class="oe_right"/>
                                        <label for="deduction_prc_gr" style="white-space: nowrap;" string="RG (TTC)"/>
                                        <field name="deduction_prc_gr" nolabel="1" class="oe_right" readonly="1"/>
                                        <label for="deduction_ten_year" style="white-space: nowrap;" string="Assurance Décennale (TTC)"/>
                                        <field name="deduction_ten_year" readonly="1" nolabel="1" class="oe_right"/>
                                       <label for="deduction_all_risk_insurance" style="white-space: nowrap;" string="Assurance TRC (HT)"/>
                                        <field name="deduction_all_risk_insurance" readonly="1" nolabel="1" class="oe_right"/>
                                        <label for="deduction_malus_retention" style="white-space: nowrap;" string="Retenue de malfaçons (HT)"/>
                                        <field name="deduction_malus_retention" nolabel="1" class="oe_right" readonly="1"/>
                                    </group>
                                    <group string="Cumul déductions">
                                        <label for="cumulative_advance_ttc" style="white-space: nowrap;" string="Avance (TTC)"/>
                                        <field name="cumulative_advance_ttc" nolabel="1" class="oe_right" readonly="1"/>
                                        <label for="cumulative_rg_ttc" style="white-space: nowrap;" string="RG (TTC)"/>
                                        <field name="cumulative_rg_ttc" nolabel="1" class="oe_right" readonly="1"/>
                                        <label for="cumulative_ten_year_ttc" style="white-space: nowrap;" string="Assurance Décennale (TTC)"/>
                                        <field name="cumulative_ten_year_ttc" nolabel="1" class="oe_right" readonly="1"/>
                                        <label for="cumulative_all_risk_insurance_ttc" style="white-space: nowrap;" string="Assurance TRC (HT)"/>
                                        <field name="cumulative_all_risk_insurance_ttc" nolabel="1" class="oe_right" readonly="1"/>
                                        <label for="cumulative_malus_retention_ht" style="white-space: nowrap;" string="Retenue de malfaçons (HT)"/>
                                        <field name="cumulative_malus_retention_ht" nolabel="1" class="oe_right" readonly="1"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Inf.Affaire">
                                <group>
                                    <group>
                                        <label for="amount_advance_ttc" style="white-space: nowrap;" string="Montant d'avance (TTC)"/>
                                        <field name="amount_advance_ttc" nolabel="1" class="oe_right"/>
                                        <label for="prc_rg" style="white-space: nowrap;" string="RG (%)"/>
                                        <field name="prc_rg" nolabel="1" class="oe_right"/>
                                    </group>
                                    <group>
                                        <label for="amount_all_risk_insurance_ttc" style="white-space: nowrap;" string="Montant Assurance TRC (TTC)"/>
                                        <field name="amount_all_risk_insurance_ttc" nolabel="1" class="oe_right"/>
                                        <label for="amount_ten_year_ttc" style="white-space: nowrap;" string="Montant Assurance Décennale (TTC)"/>
                                        <field name="amount_ten_year_ttc" nolabel="1" class="oe_right"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_panel_building_attachmenet" model="ir.ui.view">
            <field name="name">view.panel.building.attachmenet</field>
            <field name="model">building.attachment</field>
            <field name="arch" type="xml">
                <search>
                    <field name="customer_id" string="Client"/>
                    <field name="site_id" string="Affaire"/>
                    <field name="number" string="Numéro"/>
                    <filter string="Définitif" name="definitive_ok" domain="[('definitive_ok','=', True)]"/>
                    <group string="Group By...">
                        <filter string="Affaires" name="site_id" domain="[]" context="{'group_by':'site_id'}"/>
                        <filter string="Définitif" name="definitive_ok" domain="[]" context="{'group_by':'definitive_ok'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_purchase_entry_decompt_clinet_readonly" model="ir.actions.act_window">
            <field name="name">Décompte clients</field>
            <field name="res_model">building.attachment</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('opening_attachment', '=', False), ('type_attachment', '=', 'sale'), ('not_open_attachment_state', '=', 'count_established')]</field>
            <field name="view_ids" eval="[(5, 0, 0), 
                                        (0, 0, {'view_mode': 'list', 'view_id': ref('building_attachment_inv_tree')}), 
                                        (0, 0, {'view_mode': 'form', 'view_id': ref('building_attachment_inv_situation_form')})]"/>
            <field name="context">{"create": False, "edit": False, "delete": False, 'group_by': ['site_id']}</field>
        </record>
</odoo>
