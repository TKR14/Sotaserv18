<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_purchaseorder_igaser_document">
        <t t-call="web.basic_layout">
            <style>
                * {
                    margin: 0;
                    padding: 0;
                }

                table {
                    border-collapse: collapse;
                    padding: 0;
                }

                .page {
                    position: relative;
                    font-size: 18px;
                    width: 100%;
                    height: 310mm;
                }

                h2 {
                    font-size: 40px;
                    margin: 120px 0 60px 0;
                    text-align: center;
                }

                .header-box-row { width: 100%; display: inline-block; }
                .header-box-row-1 { margin-bottom: 15px; }
                .header-box-row-2 { margin-bottom: 50px; }
                .header-box-row div {
                    width: 47%;
                    border: 1px solid black;
                    float: left;
                }
                .header-box-row .last-child {
                    margin-left: 6%;
                }
                
                .total { width: 100%; display: inline-block; margin-bottom: 35px; }
                .total table {
                    width: 47%;
                    border: 1px solid black;
                    float: left;
                }
                .total table:last-child {
                    margin-left: 6%;
                }
                .total td {
                    padding: 2px 4px;
                }

                .box-row-1, .box-row-2 { width: 100%; height: 125px; text-align: center; }
                .box-row-1 table { margin: 25px 0 30px 0; }
                .box-row-1 table, .box-row-2 table {
                    height: 100%;
                    float: left;
                    border: 1px solid black;
                }
                .box-row-1 table, .box-row-2 table:first-child {
                    width: 30%;
                }
                .box-row-1 table:not(:first-child), .box-row-2 table:not(:first-child) {
                    margin-left: 5%;
                }
                .box-row-2 table:last-child {
                    width: 65%;
                }

                .footeer {
                    display: inline-block;
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 100%;
                    height: 40px;
                    text-align: center;
                    border-top: 1px solid #000;
                }
                .footeer span {
                    padding: 0 4px;
                }
            </style>
            
            <div class="page">
                <h2 style="text-align: center;">BON DE COMMANDE N° <span t-field="o.name"/></h2>

                <div class="header-box-row header-box-row-1">
                    <div>
                        <strong><span>Fournisseur</span></strong>
                        <br/>
                        <strong><span t-field="o.partner_id"/></strong>
                    </div>
                    <div class="last-child">
                        <strong>ELJADIDA: <span t-field="o.date_order"/></strong>
                        <br/>
                        <strong><span t-field="o.user_id"/></strong>
                    </div>
                </div>
                
                <div class="header-box-row header-box-row-2">
                    <div>
                        <strong>Affaire: <span t-field="o.site_id"/></strong>
                    </div>
                    <div class="last-child" t-if="o.vehicle_id">
                        <strong >IG: <span t-field="o.vehicle_id"/></strong>
                    </div>    
                </div>
                
                <table class="table table-sm o_main_table">
                    <thead>
                        <tr>
                            <th name="th_quantity" class="text-right"><strong>QTE</strong></th>
                            <th name="th_unit" class="text-right"><strong>UTE</strong></th>
                            <th name="th_description"><strong>DESIGNATION</strong></th>
                            <th name="th_price_unit" class="text-right"><strong>P.U H.T</strong></th>
                            <th name="th_discount" class="text-right"><strong>R%</strong></th>
                            <th name="th_amount" class="text-right"><strong>MONTANT</strong></th>
                            <th name="th_description"><strong>DESTINATION</strong></th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-set="current_subtotal" t-value="0"/>
                        <t t-foreach="o.order_line" t-as="line">
                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                            <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                <t t-if="not line.display_type">
                                    <td class="text-right">
                                        <span t-field="line.product_qty"/>
                                    </td>
                                    <td id="group_uom">
                                        <span t-field="line.product_uom.name" groups="uom.group_uom"/>
                                    </td>
                                    <td id="product">
                                        <span t-field="line.name"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.price_unit"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-value="0"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.price_subtotal"
                                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                    <td id="product_description_variants">
                                        <span t-field="line.product_description_variants"/>
                                    </td>
                                </t>
                                <t t-if="line.display_type == 'line_section'">
                                    <td colspan="99" id="section">
                                        <span t-field="line.name"/>
                                    </td>
                                    <t t-set="current_section" t-value="line"/>
                                    <t t-set="current_subtotal" t-value="0"/>
                                </t>
                                <t t-if="line.display_type == 'line_note'">
                                    <td colspan="99" id="note">
                                        <span t-field="line.name"/>
                                    </td>
                                </t>
                            </tr>
                            <t t-if="current_section and (line_last or o.order_line[line_index+1].display_type == 'line_section')">
                                <tr class="is-subtotal text-right">
                                    <td colspan="99" id="subtotal">
                                        <strong class="mr16">H.T</strong>
                                        <span
                                            t-esc="current_subtotal"
                                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                                        />
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>

                <div class="total">
                    <table cellspacing="0" cellpadding="0">
                        <!-- <t t-foreach="o.order_line" t-as="line"> -->
                            <t t-foreach="o.order_line.taxes_id" t-as="taxe">
                                <tr class="border-black">
                                    <td name="td_tva_name"><strong><span t-esc="taxe.name"/></strong></td>
                                </tr>
                                <tr class="border-black">
                                    <td class="text-right">
                                        <span t-esc="o.amount_untaxed*taxe.amount/100"
                                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                </tr>
                            </t>
                        <!-- </t> -->
                    </table>

                    <table cellspacing="0" cellpadding="0">
                        <tr class="border-black">
                            <td name="td_subtotal_label"><strong>H.T</strong></td>
                            <td class="text-right">
                                <span t-field="o.amount_untaxed"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </td>
                        </tr>
                        <tr>
                            <td name="td_taxes_label">TVA</td>
                            <td class="text-right">
                                <span t-field="o.amount_tax"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </td>
                        </tr>
                        <tr class="border-black o_total">
                            <td name="td_amount_total_label"><strong>T.T.C</strong></td>
                            <td class="text-right">
                                <span t-field="o.amount_total"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="box-row-1">
                    <table cellspacing="0" cellpadding="0">
                        <tr>
                            <td>Service Achats</td>
                        </tr>
                        <tr>
                            <td></td>
                        </tr>
                    </table>
                    <table cellspacing="0" cellpadding="0">
                        <tr>
                            <td>Directeur général Adjoint</td>
                        </tr>
                        <tr>
                            <td></td>
                        </tr>
                    </table>
                    <table cellspacing="0" cellpadding="0">
                        <tr>
                            <td>Directeur Général</td>
                        </tr>
                        <tr>
                            <td></td>
                        </tr>
                    </table>
                </div>
                
                <div class="box-row-2">
                    <table cellspacing="0" cellpadding="0">
                        <tr>
                            <td>Service Comptabilité</td>
                        </tr>
                        <tr>
                            <td>
                            </td>
                        </tr>
                    </table>
                    <table cellspacing="0" cellpadding="0">
                        <tr>
                            <td>Remarques</td>
                        </tr>
                        <tr>
                            <td>
                                <br/>
                                Prière de fournir votre facture en 3 exemplaire originaux<br/>
                                Veuillez mentionner le numéro du bon de commande sur vos bons de livraison.
                            </td>
                        </tr>
                    </table>
                </div>
                
                <p t-field="o.notes"/>
                
                <div class="footeer">
                    <p>
                        <span>05 23 35 29 00</span>
                        <span>contact@igaser.com</span>
                        <span>https://igaser.com</span>
                        <span>Tax ID: 05701046</span>
                    </p>
                </div>
            </div>
        </t>
    </template>

    <template id="report_purchaseorder_igaser">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="purchase_igaser.report_purchaseorder_igaser_document"/>
            </t>
        </t>
    </template>
</odoo>